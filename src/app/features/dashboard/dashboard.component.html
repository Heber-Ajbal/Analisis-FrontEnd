<!-- Contenedor principal -->
<section class="w-full px-4 md:px-6 py-8 md:py-12 space-y-6">

  <!-- Header / Filtros -->
  <div class="w-full rounded-2xl border border-gray-200 bg-white shadow-sm p-5 md:p-6">
    <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
      <div class="flex items-start gap-3">
        <mat-icon class="text-4xl text-primary-600" aria-hidden="true">dashboard</mat-icon>
        <div>
          <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">Panel Administrativo</h1>
          <p class="mt-1 text-gray-600">Resumen de métricas, gráficos y tablas clave.</p>
        </div>
      </div>

      <div>
        <button mat-stroked-button class="rounded-full h-10 px-4" [matMenuTriggerFor]="menuRango">
          <mat-icon class="mr-1">schedule</mat-icon>
          <span class="uppercase">{{ rango() }}</span>
          <mat-icon>expand_more</mat-icon>
        </button>
      </div>
    </div>

    <mat-menu #menuRango="matMenu">
      <button mat-menu-item (click)="rango.set('7d')"><mat-icon>calendar_today</mat-icon>Últimos 7 días</button>
      <button mat-menu-item (click)="rango.set('30d')"><mat-icon>date_range</mat-icon>Últimos 30 días</button>
      <button mat-menu-item (click)="rango.set('ytd')"><mat-icon>trending_up</mat-icon>YTD</button>
      <button mat-menu-item (click)="rango.set('12m')"><mat-icon>insights</mat-icon>12 meses</button>
    </mat-menu>
  </div>

  <!-- KPIs -->
  <section class="space-y-3">
    <div class="flex items-center justify-between">
      <h2 class="text-xl md:text-2xl font-bold">Métricas Clave</h2>
      <span class="text-sm text-gray-600">Actualizado hace 5 min</span>
    </div>

    <div class="grid gap-4 md:gap-6 grid-cols-1 sm:grid-cols-2 xl:grid-cols-4">
      <mat-card *ngFor="let k of kpis; let i = index"
                class="rounded-2xl border border-gray-200 bg-white shadow-sm p-5">
        <div class="flex items-center justify-between">
          <div class="w-12 h-12 rounded-xl bg-primary-600/10 text-primary-600 grid place-items-center">
            <mat-icon aria-hidden="true">{{ k.icon }}</mat-icon>
          </div>
          <div class="flex items-center gap-1 text-green-600 font-semibold text-sm">
            <mat-icon class="!text-base" aria-hidden="true">trending_up</mat-icon>
            <span>+12%</span>
          </div>
        </div>

        <div class="mt-3">
          <div class="text-3xl font-extrabold leading-none">{{ k.value | number }}</div>
          <div class="mt-1 text-sm text-gray-600">{{ k.label }}</div>
        </div>

        <div class="mt-3 border-t border-gray-100 pt-2 text-xs text-gray-500">
          vs. período anterior
        </div>
      </mat-card>
    </div>
  </section>

  <!-- Gráficos -->
  <section class="space-y-3">
    <h2 class="text-xl md:text-2xl font-bold">Análisis visual</h2>

    <div class="grid gap-4 md:gap-6 grid-cols-1 lg:grid-cols-2">
      <!-- Ventas -->
      <mat-card class="rounded-2xl border border-gray-200 bg-white shadow-sm p-5">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2">
            <mat-icon class="text-primary-600" aria-hidden="true">show_chart</mat-icon>
            <h3 class="text-lg font-semibold m-0">Evolución de ventas</h3>
          </div>
          <button mat-icon-button aria-label="Más opciones"><mat-icon>more_vert</mat-icon></button>
        </div>

        <div class="relative h-[300px]">
          <canvas baseChart [type]="lineChartType" [data]="lineChartData" [options]="lineChartOptions"></canvas>
        </div>

        <div class="mt-3 pt-3 border-t border-gray-100 text-sm text-gray-600 flex items-center gap-3">
          <span class="inline-flex items-center gap-2">
            <span class="inline-block w-3 h-3 rounded-full bg-blue-500"></span> Ventas totales
          </span>
        </div>
      </mat-card>

      <!-- Inventario vs Rotación -->
      <mat-card class="rounded-2xl border border-gray-200 bg-white shadow-sm p-5">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2">
            <mat-icon class="text-primary-600" aria-hidden="true">inventory_2</mat-icon>
            <h3 class="text-lg font-semibold m-0">Inventario vs. rotación</h3>
          </div>
          <button mat-icon-button aria-label="Más opciones"><mat-icon>more_vert</mat-icon></button>
        </div>

        <div class="relative h-[300px]">
          <canvas baseChart [data]="mixChartData" [options]="mixChartOptions"></canvas>
        </div>

        <div class="mt-3 pt-3 border-t border-gray-100 text-sm text-gray-600 flex items-center gap-4">
          <span class="inline-flex items-center gap-2">
            <span class="inline-block w-3 h-3 rounded-full bg-purple-500"></span> Stock disponible
          </span>
          <span class="inline-flex items-center gap-2">
            <span class="inline-block w-3 h-3 rounded-full bg-orange-500"></span> Rotación
          </span>
        </div>
      </mat-card>
    </div>

    <!-- Dona -->
    <mat-card class="rounded-2xl border border-gray-200 bg-white shadow-sm p-5">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-2">
          <mat-icon class="text-primary-600" aria-hidden="true">pie_chart</mat-icon>
          <h3 class="text-lg font-semibold m-0">Distribución por categoría</h3>
        </div>
        <button mat-icon-button aria-label="Más opciones"><mat-icon>more_vert</mat-icon></button>
      </div>

      <div class="relative h-[340px]">
        <canvas baseChart [type]="doughnutType" [data]="doughnutData" [options]="doughnutOptions"></canvas>
      </div>
    </mat-card>
  </section>

  <!-- Tablas -->
  <section class="space-y-3">
    <h2 class="text-xl md:text-2xl font-bold">Detalles de inventario</h2>

    <div class="grid gap-4 md:gap-6 grid-cols-1 lg:grid-cols-2">
      <!-- Top productos -->
      <mat-card class="rounded-2xl border border-gray-200 bg-white shadow-sm p-5">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2">
            <mat-icon class="text-green-600" aria-hidden="true">stars</mat-icon>
            <h3 class="text-lg font-semibold m-0">Top productos</h3>
          </div>
          <button mat-button color="primary" class="rounded-full">Ver todos<mat-icon>arrow_forward</mat-icon></button>
        </div>

        <div class="overflow-x-auto">
          <table mat-table [dataSource]="topProductos" class="w-full">
            <ng-container matColumnDef="sku">
              <th mat-header-cell *matHeaderCellDef class="th"><span class="flex items-center gap-2"><mat-icon class="text-gray-500">tag</mat-icon>SKU</span></th>
              <td mat-cell *matCellDef="let e"><span class="sku-badge">{{ e.sku }}</span></td>
            </ng-container>

            <ng-container matColumnDef="nombre">
              <th mat-header-cell *matHeaderCellDef class="th"><span class="flex items-center gap-2"><mat-icon class="text-gray-500">inventory</mat-icon>Producto</span></th>
              <td mat-cell *matCellDef="let e"><span class="font-medium text-gray-800">{{ e.nombre }}</span></td>
            </ng-container>

            <ng-container matColumnDef="stock">
              <th mat-header-cell *matHeaderCellDef class="th"><span class="flex items-center gap-2"><mat-icon class="text-gray-500">storage</mat-icon>Stock</span></th>
              <td mat-cell *matCellDef="let e"><span class="pill success">{{ e.stock }}</span></td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-gray-50"></tr>
          </table>
        </div>
      </mat-card>

      <!-- Reposiciones -->
      <mat-card class="rounded-2xl border border-gray-200 bg-white shadow-sm p-5">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2">
            <mat-icon class="text-amber-600" aria-hidden="true">warning</mat-icon>
            <h3 class="text-lg font-semibold m-0">Reposiciones pendientes</h3>
          </div>
          <span class="px-3 py-1 rounded-full text-xs font-semibold bg-amber-50 text-amber-700">
            {{ pendientes.length }} alertas
          </span>
        </div>

        <div class="overflow-x-auto">
          <table mat-table [dataSource]="pendientes" class="w-full">
            <ng-container matColumnDef="sku">
              <th mat-header-cell *matHeaderCellDef class="th"><span class="flex items-center gap-2"><mat-icon class="text-gray-500">tag</mat-icon>SKU</span></th>
              <td mat-cell *matCellDef="let e"><span class="sku-badge warn">{{ e.sku }}</span></td>
            </ng-container>

            <ng-container matColumnDef="nombre">
              <th mat-header-cell *matHeaderCellDef class="th"><span class="flex items-center gap-2"><mat-icon class="text-gray-500">inventory</mat-icon>Producto</span></th>
              <td mat-cell *matCellDef="let e"><span class="font-medium text-gray-800">{{ e.nombre }}</span></td>
            </ng-container>

            <ng-container matColumnDef="minimo">
              <th mat-header-cell *matHeaderCellDef class="th"><span class="flex items-center gap-2"><mat-icon class="text-gray-500">priority_high</mat-icon>Mín.</span></th>
              <td mat-cell *matCellDef="let e"><span class="pill">{{ e.minimo }}</span></td>
            </ng-container>

            <ng-container matColumnDef="actual">
              <th mat-header-cell *matHeaderCellDef class="th"><span class="flex items-center gap-2"><mat-icon class="text-gray-500">inventory_2</mat-icon>Actual</span></th>
              <td mat-cell *matCellDef="let e"><span class="pill danger">{{ e.actual }}</span></td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumnsPend"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumnsPend;" class="hover:bg-gray-50"></tr>
          </table>
        </div>
      </mat-card>
    </div>
  </section>
</section>
