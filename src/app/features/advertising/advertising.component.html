<!-- Contenedor principal -->
<section class="w-full px-4 md:px-6 py-8 md:py-12 space-y-6">

  <!-- Header / Toolbar simple (sin glassmorphism) -->
  <div class="w-full rounded-2xl border border-gray-200 bg-white shadow-sm p-5 md:p-6">
    <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
      <div class="flex items-start gap-3 min-w-0">
        <mat-icon class="text-4xl md:text-5xl text-primary-600" aria-hidden="true">campaign</mat-icon>
        <div class="min-w-0">
          <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">
            Publicidad y campañas
          </h1>
          <p class="mt-1 text-gray-600">
            Monitorea el rendimiento de tus campañas activas y planificadas.
          </p>
        </div>
      </div>

      <div class="flex items-center gap-2 md:gap-3">
        <button mat-stroked-button color="primary" class="rounded-full h-10 px-4">
          <mat-icon class="mr-1">add</mat-icon>
          Nueva campaña
        </button>
        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Más acciones">
          <mat-icon>more_vert</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <mat-menu #menu="matMenu">
    <button mat-menu-item>
      <mat-icon>file_download</mat-icon>
      <span>Exportar reporte</span>
    </button>
    <button mat-menu-item>
      <mat-icon>notifications_active</mat-icon>
      <span>Configurar alertas</span>
    </button>
  </mat-menu>

  <!-- Resumen -->
  <div class="grid gap-4 md:gap-6 grid-cols-1 sm:grid-cols-2 xl:grid-cols-4">
    <mat-card class="rounded-2xl overflow-hidden border border-gray-200 bg-white shadow-sm p-5">
      <div class="text-xs uppercase tracking-wide text-gray-500 font-semibold">Campañas activas</div>
      <div class="mt-2 text-3xl font-extrabold">{{ stats().active }}</div>
      <div class="mt-1 text-sm text-gray-600">de {{ stats().totalCampaigns }} totales</div>
    </mat-card>

    <mat-card class="rounded-2xl overflow-hidden border border-gray-200 bg-white shadow-sm p-5">
      <div class="text-xs uppercase tracking-wide text-gray-500 font-semibold">Presupuesto invertido</div>
      <div class="mt-2 text-3xl font-extrabold">
        {{ stats().spent | currency:'MXN':'symbol-narrow' }}
      </div>
      <mat-progress-bar class="mt-3" mode="determinate" [value]="stats().spendRatio"></mat-progress-bar>
      <div class="mt-1 text-sm text-gray-600">
        {{ stats().spendRatio | number:'1.0-1' }}% del presupuesto asignado
      </div>
    </mat-card>

    <mat-card class="rounded-2xl overflow-hidden border border-gray-200 bg-white shadow-sm p-5">
      <div class="text-xs uppercase tracking-wide text-gray-500 font-semibold">CTR promedio</div>
      <div class="mt-2 text-3xl font-extrabold">{{ stats().ctr | number:'1.1-2' }}%</div>
      <div class="mt-1 text-sm text-gray-600">
        {{ stats().clicks | number }} clics / {{ stats().impressions | number }} impresiones
      </div>
    </mat-card>

    <mat-card class="rounded-2xl overflow-hidden border border-gray-200 bg-white shadow-sm p-5">
      <div class="text-xs uppercase tracking-wide text-gray-500 font-semibold">Conversiones</div>
      <div class="mt-2 text-3xl font-extrabold">{{ stats().conversions | number }}</div>
      <div class="mt-1 text-sm text-gray-600">Tasa de conversión {{ stats().cvr | number:'1.1-2' }}%</div>
    </mat-card>
  </div>

  <!-- Panel: Campañas en curso -->
  <section class="rounded-2xl border border-gray-200 bg-white shadow-sm p-5 md:p-8 space-y-5">
    <div class="flex items-center justify-between">
      <h2 class="text-xl md:text-2xl font-bold">Campañas en curso</h2>
      <a mat-button color="primary" class="rounded-full">
        <mat-icon class="mr-1">insights</mat-icon>
        Ver analíticas detalladas
      </a>
    </div>

    <div class="grid gap-4 md:gap-6 grid-cols-1 sm:grid-cols-2 xl:grid-cols-3" *ngIf="runningCampaigns().length; else empty">
      <mat-card *ngFor="let campaign of runningCampaigns()"
                class="rounded-2xl overflow-hidden border border-gray-200 bg-white shadow-sm p-5 flex flex-col gap-4">
        <!-- Header -->
        <div class="flex items-start justify-between gap-3">
          <div class="flex items-start gap-3 min-w-0">
            <mat-icon class="text-3xl text-primary-600" aria-hidden="true">{{ channelIcon(campaign.channel) }}</mat-icon>
            <div class="min-w-0">
              <h3 class="font-semibold text-lg leading-tight truncate">{{ campaign.name }}</h3>
              <span class="text-xs text-gray-500">Desde {{ campaign.startDate | date:'d MMM y' }}</span>
            </div>
          </div>
          <span class="status-badge" [class]="statusClass(campaign.status)">
            {{ statusLabel(campaign.status) }}
          </span>
        </div>

        <!-- Métricas -->
        <div class="grid grid-cols-2 gap-3 bg-gray-50 rounded-xl p-3">
          <div>
            <span class="block text-[11px] uppercase text-gray-500 font-semibold">Impresiones</span>
            <span class="block text-base font-bold">{{ campaign.impressions | number }}</span>
          </div>
          <div>
            <span class="block text-[11px] uppercase text-gray-500 font-semibold">Clics</span>
            <span class="block text-base font-bold">{{ campaign.clicks | number }}</span>
          </div>
          <div>
            <span class="block text-[11px] uppercase text-gray-500 font-semibold">Conversiones</span>
            <span class="block text-base font-bold">{{ campaign.conversions | number }}</span>
          </div>
          <div>
            <span class="block text-[11px] uppercase text-gray-500 font-semibold">Gasto</span>
            <span class="block text-base font-bold">{{ campaign.spent | currency:'MXN':'symbol-narrow' }}</span>
          </div>
        </div>

        <mat-divider></mat-divider>

        <div class="flex justify-end gap-2">
          <button mat-button class="rounded-full">Editar</button>
          <button mat-button class="rounded-full">Duplicar</button>
          <button mat-button color="warn" class="rounded-full">Pausar</button>
        </div>
      </mat-card>
    </div>
  </section>

  <!-- Panel: Campañas planificadas y recientes -->
  <section class="rounded-2xl border border-gray-200 bg-white shadow-sm p-5 md:p-8 space-y-5">
    <h2 class="text-xl md:text-2xl font-bold">Campañas planificadas y recientes</h2>

    <mat-list class="divide-y divide-gray-100">
      <mat-list-item *ngFor="let campaign of otherCampaigns()" class="hover:bg-gray-50">
        <mat-icon matListItemIcon class="text-gray-700">{{ channelIcon(campaign.channel) }}</mat-icon>

        <div matListItemTitle class="flex items-center gap-2">
          <span class="truncate">{{ campaign.name }}</span>
          <span class="status-badge small" [class]="statusClass(campaign.status)">
            {{ statusLabel(campaign.status) }}
          </span>
        </div>

        <div matListItemLine class="text-sm text-gray-600">
          Presupuesto {{ campaign.budget | currency:'MXN':'symbol-narrow' }} ·
          Inicio {{ campaign.startDate | date:'mediumDate' }}
          <ng-container *ngIf="campaign.endDate">
            · Fin {{ campaign.endDate | date:'mediumDate' }}
          </ng-container>
        </div>

        <div matListItemMeta>
          <button mat-icon-button aria-label="Ver detalles">
            <mat-icon>open_in_new</mat-icon>
          </button>
        </div>
      </mat-list-item>
    </mat-list>
  </section>
</section>

<!-- Empty state -->
<ng-template #empty>
  <mat-card class="mx-auto my-8 max-w-md text-center rounded-2xl border border-dashed border-gray-300 bg-white p-10">
    <mat-icon class="text-5xl text-primary-600 mb-2" aria-hidden="true">schedule</mat-icon>
    <h3 class="text-lg font-semibold">No hay campañas activas</h3>
    <p class="text-gray-600 mt-1">Planifica una nueva campaña o reactiva una existente para comenzar a medir resultados.</p>
    <button mat-raised-button color="primary" class="mt-4 rounded-full">Crear campaña</button>
  </mat-card>
</ng-template>
