<div class="min-h-screen grid place-items-center p-6 bg">
  <div class="w-full max-w-3xl rounded-2xl border border-white/10 p-6 md:p-8 card">
    <h1 class="text-2xl font-bold mb-1 text-center">Crear cuenta</h1>
    <p class="mb-4 text-center text-muted">
      Elige el tipo de usuario y completa tus datos.
    </p>

    <mat-tab-group [(selectedIndex)]="tabIndex" class="mb-2" [dynamicHeight]="true">
      <!-- CLIENTE -->
      <mat-tab>
        <ng-template mat-tab-label>
          <div class="flex items-center gap-2">
            <iconify-icon icon="mdi:account" width="18"></iconify-icon>
            <span>Cliente</span>
          </div>
        </ng-template>

        <form class="grid gap-3 mt-4" [formGroup]="clienteForm" (ngSubmit)="registrarCliente()">
          <div class="grid md:grid-cols-2 gap-3">
            <mat-form-field appearance="fill">
              <mat-label>Nombres</mat-label>
              <input matInput formControlName="name" placeholder="Juan Pérez" autocomplete="name" />
              <mat-hint>Tu nombre completo</mat-hint>
              <mat-error *ngIf="clienteForm.get('name')?.hasError('required')">Campo obligatorio</mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Teléfono</mat-label>
              <input matInput formControlName="phone" placeholder="+502 5555 5555" autocomplete="tel" />
              <mat-hint>Incluye código de país</mat-hint>
              <mat-error *ngIf="clienteForm.get('phone')?.hasError('required')">Campo obligatorio</mat-error>
            </mat-form-field>
          </div>

          <div class="grid md:grid-cols-2 gap-3">
            <mat-form-field appearance="fill">
              <mat-label>Correo</mat-label>
              <input matInput type="email" formControlName="email" placeholder="cliente@correo.com"
                     autocomplete="email" spellcheck="false" />
              <mat-error *ngIf="clienteForm.get('email')?.hasError('required')">Campo obligatorio</mat-error>
              <mat-error *ngIf="clienteForm.get('email')?.hasError('email')">Correo inválido</mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Contraseña</mat-label>
              <input matInput [type]="hide1 ? 'password' : 'text'" formControlName="pass"
                     placeholder="••••••" autocomplete="new-password" />
              <button mat-icon-button matSuffix type="button" (click)="hide1 = !hide1"
                      aria-label="Mostrar/ocultar contraseña">
                <mat-icon>{{ hide1 ? 'visibility' : 'visibility_off' }}</mat-icon>
              </button>
              <mat-hint>Min. 6 caracteres</mat-hint>
              <mat-error *ngIf="clienteForm.get('pass')?.hasError('required')">Campo obligatorio</mat-error>
              <mat-error *ngIf="clienteForm.get('pass')?.hasError('minlength')">Mínimo 6 caracteres</mat-error>
            </mat-form-field>
          </div>

          <!-- Acciones: botón ancho completo + mensaje debajo -->
          <div class="mt-2">
            <div class="flex flex-col gap-1 mb-2">
              <re-captcha
                #clienteCaptchaRef
                formControlName="captcha"
                [siteKey]="siteKey"
                theme="light"
              ></re-captcha>
              <mat-error *ngIf="clienteForm.get('captcha')?.hasError('required') && clienteForm.get('captcha')?.touched">
                Confirma que no eres un robot
              </mat-error>
            </div>
            <button mat-flat-button color="primary" type="submit"
                    class="w-full h-11 justify-center"
                    [disabled]="clienteForm.invalid || loading">
              Crear cuenta
            </button>
            <p class="mt-3 text-center text-muted">
              ¿Ya tienes cuenta? <a class="link" routerLink="/login">Inicia sesión</a>
            </p>
          </div>

          <!-- Divider + social SOLO en Cliente -->
          <div class="my-6">
            <div class="flex items-center gap-3 text-muted">
              <div class="flex-1 h-px bg-[color:var(--mat-sys-outline-variant)] opacity-60"></div>
              <span class="text-xs uppercase tracking-wider">o regístrate con</span>
              <div class="flex-1 h-px bg-[color:var(--mat-sys-outline-variant)] opacity-60"></div>
            </div>

            <div class="mt-4 grid grid-cols-3 gap-3">
              <button type="button" class="h-10 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center justify-center"
                      [disabled]="loading" aria-label="Registrarse con Google" >
                <iconify-icon icon="logos:google-icon" width="20"></iconify-icon>
                <span class="sr-only">Google</span>
              </button>
              <button type="button" class="h-10 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center justify-center"
                      [disabled]="loading" aria-label="Registrarse con Facebook">
                <iconify-icon icon="logos:facebook" width="20"></iconify-icon>
                <span class="sr-only">Facebook</span>
              </button>
              <button type="button" class="h-10 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center justify-center"
                      [disabled]="loading" aria-label="Registrarse con GitHub">
                <iconify-icon icon="mdi:github" width="20"></iconify-icon>
                <span class="sr-only">GitHub</span>
              </button>
            </div>
          </div>
        </form>
      </mat-tab>

      <!-- EMPRESA (sin social y sin scroll interno) -->
      <mat-tab>
        <ng-template mat-tab-label>
          <div class="flex items-center gap-2">
            <iconify-icon icon="mdi:office-building" width="18"></iconify-icon>
            <span>Empresa</span>
          </div>
        </ng-template>

        <form class="grid gap-3 mt-4" [formGroup]="empresaForm" (ngSubmit)="registrarEmpresa()">
          <div class="grid md:grid-cols-2 gap-3">
            <mat-form-field appearance="fill">
              <mat-label>Empresa</mat-label>
              <input matInput formControlName="company" placeholder="Mi Empresa S.A." autocomplete="organization" />
              <mat-error *ngIf="empresaForm.get('company')?.hasError('required')">Campo obligatorio</mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>NIT / RTU</mat-label>
              <input matInput formControlName="rtu" placeholder="XXXXXXXXX" />
              <mat-hint>Tal como figura en el documento</mat-hint>
              <mat-error *ngIf="empresaForm.get('rtu')?.hasError('required')">Campo obligatorio</mat-error>
            </mat-form-field>
          </div>

          <div class="grid md:grid-cols-2 gap-3">
            <mat-form-field appearance="fill">
              <mat-label>Administrador – Nombre</mat-label>
              <input matInput formControlName="adminName" placeholder="Ana Gómez" autocomplete="name" />
              <mat-error *ngIf="empresaForm.get('adminName')?.hasError('required')">Campo obligatorio</mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Administrador – DPI</mat-label>
              <input matInput formControlName="dpi" placeholder="1234567890101" />
              <mat-hint>Sin espacios ni guiones</mat-hint>
              <mat-error *ngIf="empresaForm.get('dpi')?.hasError('required')">Campo obligatorio</mat-error>
            </mat-form-field>
          </div>

          <div class="grid md:grid-cols-2 gap-3">
            <mat-form-field appearance="fill">
              <mat-label>Correo</mat-label>
              <input matInput type="email" formControlName="email" placeholder="admin@empresa.com"
                     autocomplete="email" spellcheck="false" />
              <mat-error *ngIf="empresaForm.get('email')?.hasError('required')">Campo obligatorio</mat-error>
              <mat-error *ngIf="empresaForm.get('email')?.hasError('email')">Correo inválido</mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Contraseña</mat-label>
              <input matInput [type]="hide2 ? 'password' : 'text'" formControlName="pass"
                     placeholder="••••••" autocomplete="new-password" />
              <button mat-icon-button matSuffix type="button" (click)="hide2 = !hide2"
                      aria-label="Mostrar/ocultar contraseña">
                <mat-icon>{{ hide2 ? 'visibility' : 'visibility_off' }}</mat-icon>
              </button>
              <mat-hint>Min. 6 caracteres</mat-hint>
              <mat-error *ngIf="empresaForm.get('pass')?.hasError('required')">Campo obligatorio</mat-error>
              <mat-error *ngIf="empresaForm.get('pass')?.hasError('minlength')">Mínimo 6 caracteres</mat-error>
            </mat-form-field>
          </div>

          <div class="p-3 rounded-lg bg-white/5 border border-white/10 text-sm text-muted">
            Al enviar, la cuenta de empresa pasa a <b>revisión manual</b>.
          </div>

          <div class="mt-2">
            <div class="flex flex-col gap-1 mb-2">
              <re-captcha
                #empresaCaptchaRef
                formControlName="captcha"
                [siteKey]="siteKey"
                theme="light"
              ></re-captcha>
              <mat-error *ngIf="empresaForm.get('captcha')?.hasError('required') && empresaForm.get('captcha')?.touched">
                Confirma que no eres un robot
              </mat-error>
            </div>
            <button mat-stroked-button color="primary" type="submit"
                    class="w-full h-11 justify-center"
                    [disabled]="empresaForm.invalid || loading">
              Enviar a revisión
            </button>
          </div>
        </form>
      </mat-tab>
    </mat-tab-group>

    <div class="mt-4 flex items-center gap-2" *ngIf="loading">
      <mat-progress-spinner mode="indeterminate" diameter="20"></mat-progress-spinner>
      <span class="text-muted">Procesando…</span>
    </div>
  </div>
</div>
