<section class="inventory">
  <header class="inventory__header">
    <div class="inventory__title">
      <mat-icon class="inventory__title-icon">inventory_2</mat-icon>
      <div>
        <h1>Inventario</h1>
        <p>Consulta y administra tus productos.</p>
      </div>
    </div>
    <button mat-flat-button color="primary" (click)="openNew()">
      <mat-icon>add</mat-icon>
      Nuevo producto
    </button>
  </header>

  <mat-card class="filters">
    <div class="filters__grid">
      <mat-form-field appearance="outline">
        <mat-label>Buscar</mat-label>
        <mat-icon matPrefix>search</mat-icon>
        <input
          matInput
          [value]="q()"
          (input)="onSearch($any($event.target).value)"
          placeholder="SKU o nombre"
          autocomplete="off"
        />
        <button mat-icon-button matSuffix *ngIf="q()" (click)="onSearch('')" type="button">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Categoría</mat-label>
        <mat-select [value]="categoria()" (selectionChange)="onCategoria($event.value)">
          <mat-option [value]="null">Todas</mat-option>
          <mat-option *ngFor="let cat of categorias()" [value]="cat">{{ cat }}</mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-stroked-button type="button" class="filters__reset" (click)="resetFilters()" *ngIf="q() || categoria()">
        <mat-icon>filter_alt_off</mat-icon>
        Limpiar filtros
      </button>
    </div>
  </mat-card>

  <mat-card class="table-card">
    <div class="table-card__state" *ngIf="loading()">
      <mat-progress-spinner mode="indeterminate" diameter="36"></mat-progress-spinner>
      <span>Cargando productos…</span>
    </div>

    <ng-container *ngIf="!loading()">
      <div class="table-card__state table-card__state--empty" *ngIf="rows().length === 0">
        <mat-icon>inventory</mat-icon>
        <p>No hay productos para mostrar.</p>
      </div>

      <ng-container *ngIf="rows().length > 0">
        <div class="table-card__wrap">
          <table class="inventory-table">
            <thead>
              <tr>
                <th>SKU</th>
                <th>Producto</th>
                <th>Precio</th>
                <th>Estado</th>
                <th class="actions">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of rows()">
                <td><span class="sku">{{ item.sku }}</span></td>
                <td>
                  <div class="product">
                    <div class="product__name">{{ item.nombre }}</div>
                    <div class="product__meta">
                      <span *ngIf="item.categoria">{{ item.categoria }}</span>
                      <span *ngIf="item.categoria && item.proveedor">•</span>
                      <span *ngIf="item.proveedor">{{ item.proveedor }}</span>
                    </div>
                  </div>
                </td>
                <td>
                  <span class="price">Q {{ item.precio | number:'1.2-2' }}</span>
                </td>
                <td>
                  <span class="status" [ngClass]="item.estado">
                    {{ item.estado === 'bajo-stock' ? 'Bajo stock' : (item.estado | titlecase) }}
                  </span>
                </td>
                <td class="actions">
                  <button mat-icon-button (click)="openEdit(item)" matTooltip="Editar">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button mat-icon-button (click)="openMoves(item)" matTooltip="Movimientos">
                    <mat-icon>history</mat-icon>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <mat-paginator
          [length]="total()"
          [pageIndex]="page() - 1"
          [pageSize]="pageSize()"
          [pageSizeOptions]="[10, 25, 50]"
          (page)="onPage($event)"
        ></mat-paginator>
      </ng-container>
    </ng-container>
  </mat-card>
</section>
