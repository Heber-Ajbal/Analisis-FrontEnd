<mat-toolbar class="toolbar luxe">
  <div class="brand">
    <mat-icon>inventory_2</mat-icon>
    <span>Inventario</span>
    <span class="hint">portal admin</span>
  </div>

  <span class="spacer"></span>

  <div class="toolbar-actions">
    <button mat-flat-button color="primary" class="pill" (click)="openNew()">
      <mat-icon>add</mat-icon><span>Nuevo</span>
    </button>
  </div>
</mat-toolbar>

<div class="page">
  <!-- Filtros -->
  <mat-card class="card filters">
    <div class="filters-grid">
      <mat-form-field appearance="fill" class="field">
        <mat-label>Buscar</mat-label>
        <mat-icon matPrefix>search</mat-icon>
        <input matInput placeholder="SKU, nombre, proveedor…" [value]="q()" (input)="q.set($any($event.target).value)" />
        <button *ngIf="q()" matSuffix mat-icon-button aria-label="Clear" (click)="q.set('')">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="fill" class="field w-200">
        <mat-label>Categoría</mat-label>
        <mat-icon matPrefix>category</mat-icon>
        <mat-select [value]="categoria()" (selectionChange)="categoria.set($event.value)">
          <mat-option [value]="null">Todas</mat-option>
          <mat-option *ngFor="let c of categorias()" [value]="c">{{ c }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill" class="field w-160">
        <mat-label>Estado</mat-label>
        <mat-icon matPrefix>offline_pin</mat-icon>
        <mat-select [value]="estado()" (selectionChange)="estado.set($event.value)">
          <mat-option [value]="null">Todos</mat-option>
          <mat-option value="activo">Activo</mat-option>
          <mat-option value="inactivo">Inactivo</mat-option>
          <mat-option value="bajo-stock">Bajo stock</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="chips">
      <mat-chip-set>
        <mat-chip *ngIf="q()" class="chip" (removed)="q.set('')">
          <mat-icon>search</mat-icon> {{ q() }} <mat-icon matChipRemove>cancel</mat-icon>
        </mat-chip>
        <mat-chip *ngIf="categoria()" class="chip" (removed)="categoria.set(null)">
          <mat-icon>category</mat-icon> {{ categoria() }} <mat-icon matChipRemove>cancel</mat-icon>
        </mat-chip>
        <mat-chip *ngIf="estado()" class="chip" (removed)="estado.set(null)">
          <mat-icon>offline_pin</mat-icon> {{ estado() }} <mat-icon matChipRemove>cancel</mat-icon>
        </mat-chip>
      </mat-chip-set>
    </div>
  </mat-card>

  <!-- Tabla -->
  <mat-card class="card table-card">
    <div class="table-wrap">
      <table mat-table [dataSource]="rows()" class="mat-elevation-z2 luxe-table">



        <!-- SKU -->
        <ng-container matColumnDef="sku">
          <th mat-header-cell *matHeaderCellDef class="th-mono">SKU</th>
          <td mat-cell *matCellDef="let e"><span class="mono">{{ e.sku }}</span></td>
        </ng-container>

        <!-- Producto -->
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef>Producto</th>
          <td mat-cell *matCellDef="let e">
            <div class="prod">
              <img *ngIf="e.imagenUrl" [src]="e.imagenUrl" alt="" />
              <div class="col">
                <div class="p-name">{{ e.nombre }}</div>
                <div class="p-meta">{{ e.categoria }} • {{ e.proveedor || '—' }}</div>
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Precio -->
        <ng-container matColumnDef="precio">
          <th mat-header-cell *matHeaderCellDef>Precio</th>
          <td mat-cell *matCellDef="let e">{{ e.precio | currency:'Q' }}</td>
        </ng-container>

        <!-- Stock -->
        <ng-container matColumnDef="stock">
          <th mat-header-cell *matHeaderCellDef>Stock</th>
          <td mat-cell *matCellDef="let e">
            <span [class.low]="e.stock <= e.minimo" class="strong">{{ e.stock }}</span>
            <span class="min">/ min {{ e.minimo }}</span>
          </td>
        </ng-container>

        <!-- Estado -->
        <ng-container matColumnDef="estado">
          <th mat-header-cell *matHeaderCellDef>Estado</th>
          <td mat-cell *matCellDef="let e">
            <span class="badge"
                  [class.badge--ok]="e.estado==='activo'"
                  [class.badge--warn]="e.estado==='bajo-stock'"
                  [class.badge--muted]="e.estado==='inactivo'">
              {{ e.estado | titlecase }}
            </span>
          </td>
        </ng-container>

        <!-- Acciones -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let e" class="actions">
            <button mat-icon-button [matMenuTriggerFor]="rowMenu" aria-label="Acciones">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #rowMenu="matMenu">
              <button mat-menu-item (click)="openEdit(e)"><mat-icon>edit</mat-icon><span>Editar</span></button>
              <button mat-menu-item (click)="openMoves(e)"><mat-icon>history</mat-icon><span>Movimientos</span></button>
            </mat-menu>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="['sku','nombre','precio','stock','estado','acciones']" class="sticky"></tr>
        <tr mat-row *matRowDef="let row; columns: ['sku','nombre','precio','stock','estado','acciones'];" class="row"></tr>
      </table>
    </div>
  </mat-card>
</div>
