<form [formGroup]="form" (ngSubmit)="save()">
  <h2 mat-dialog-title class="title">
    <mat-icon>inventory_2</mat-icon>
    <span>{{ form.value.id ? 'Editar producto' : 'Nuevo producto' }}</span>
  </h2>

  <mat-dialog-content class="content">
    <mat-form-field appearance="fill">
      <mat-label>SKU</mat-label>
      <input matInput formControlName="sku" placeholder="000123" autocomplete="off" />
      <mat-error *ngIf="form.get('sku')?.invalid">Requerido</mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Nombre</mat-label>
      <input matInput formControlName="nombre" placeholder="Producto X" autocomplete="off" />
      <mat-error *ngIf="form.get('nombre')?.invalid">Requerido</mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Categoría</mat-label>
      <input matInput formControlName="categoria" placeholder="Ej. Filtro" />
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Proveedor</mat-label>
      <input matInput formControlName="proveedor" placeholder="Ej. ACME" />
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Precio</mat-label>
      <input matInput type="number" min="0" step="0.01" formControlName="precio" placeholder="0.00" />
      <mat-error *ngIf="form.get('precio')?.hasError('required')">Requerido</mat-error>
      <mat-error *ngIf="form.get('precio')?.hasError('min')">No puede ser negativo</mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Cantidad inicial (inventario)</mat-label>
      <input
        matInput
        type="number"
        min="0"
        step="1"
        formControlName="stock"
        placeholder="0"
        [disabled]="form.value.id"
      />
      <mat-hint *ngIf="form.value.id">Actualiza el stock desde los movimientos de inventario.</mat-hint>
      <mat-error *ngIf="form.get('stock')?.hasError('min')">No puede ser negativo</mat-error>
    </mat-form-field>

    <ng-container *ngIf="form.value.id">
      <mat-form-field appearance="fill">
        <mat-label>Movimiento de inventario</mat-label>
        <mat-select formControlName="adjustmentAction">
          <mat-option value="add">Agregar unidades</mat-option>
          <mat-option value="remove">Retirar unidades</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Cantidad a mover</mat-label>
        <input
          matInput
          type="number"
          min="0"
          step="1"
          formControlName="adjustmentQuantity"
          placeholder="0"
        />
        <mat-hint>Solo se aplicará si es mayor a 0.</mat-hint>
        <mat-error *ngIf="form.get('adjustmentQuantity')?.hasError('min')">
          No puede ser negativo
        </mat-error>
      </mat-form-field>
    </ng-container>

    <mat-form-field appearance="fill">
      <mat-label>Descripción</mat-label>
      <textarea matInput rows="3" formControlName="description" placeholder="Opcional"></textarea>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>URL de imagen (UI)</mat-label>
      <input matInput formControlName="imagenUrl" placeholder="https://..." />
    </mat-form-field>

    <div class="preview" *ngIf="form.value.imagenUrl">
      <img [src]="form.value.imagenUrl!" alt="preview" />
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end" class="actions">
    <button mat-button type="button" (click)="close()">Cancelar</button>
    <button mat-flat-button color="primary" type="submit" [disabled]="form.invalid || loading">
      <mat-icon *ngIf="!loading">save</mat-icon>
      <mat-icon *ngIf="loading">hourglass_top</mat-icon>
      <span>{{ loading ? 'Guardando…' : 'Guardar' }}</span>
    </button>
  </mat-dialog-actions>
</form>
